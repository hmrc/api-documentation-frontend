@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.apidocumentation.controllers
@import uk.gov.hmrc.apidocumentation.models.DocumentationTypeFilter
@import uk.gov.hmrc.apiplatform.modules.apis.domain.models.ApiCategory
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.govukfrontend.views.viewmodels.checkboxes.Checkboxes
@import views.html.helper.CSPNonce

@this(govukCheckboxes: GovukCheckboxes, govukInput: GovukInput, govukDetails: GovukDetails)

@(docTypeFilters: List[DocumentationTypeFilter], categoryFilters: List[ApiCategory], searchTerm: Option[String])(implicit requestHeader: RequestHeader)

<h2 class="govuk-heading-m govuk-visually-hidden">Filters</h2>

<form method="GET" action="@controllers.routes.FilteredDocumentationIndexController.apiListIndexPage(List.empty, List.empty, None)">

    @govukInput(Input(
      id = "searchTerm",
      name = "searchTerm",
        label = Label(content = Text("Search APIs"), classes="govuk-fieldset__legend--s"),
        classes = "govuk-input--width-15",
        value = searchTerm,
        hint = Some(Hint(content = Text("Search the API name and description")))
    ))
    <br>

    <fieldset id="docTypeFilters" class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
            <h2 class="govuk-fieldset__heading">
                Filter by document type
            </h2>
        </legend>
        @govukDetails(
          Details(
            id = Some("docTypeFilterDetails"),
              classes = "govuk-!-margin-bottom-1",
              content = HtmlContent(
                govukCheckboxes(
                    Checkboxes(
                        name = "docTypeFilters",
                        classes="govuk-checkboxes--small",
                        items = DocumentationTypeFilter.values.map(filter =>
                            CheckboxItem(id = Some(filter.modifier), content =  HtmlContent(s"<span class=\"govuk-!-font-size-16\">${filter.displayName}</span>"), value = filter.toString, checked = docTypeFilters.contains(filter))).toSeq
                    )
                )
              ),
              summary = Text("View document types"),
              open = false
          )
        )
        <div class="govuk-body" style="font-size:16px; ">
            <strong id="docTypeFilterCount">@{docTypeFilters.size}</strong>  selected
        </div>
    </fieldset>

    <br>

    <fieldset id="categoryFilters" class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
            <h2 class="govuk-fieldset__heading">
                Filter by API category
            </h2>
        </legend>
        @govukDetails(
          Details(
              id = Some("categoryFilterDetails"),
            classes = "govuk-!-margin-bottom-1",
            content = HtmlContent(
                govukCheckboxes(
                    Checkboxes(
                        name = "categoryFilters",
                        classes="govuk-checkboxes--small",
                        items = ApiCategory.values.toList.sortBy(_.displayText).map(category =>
                            CheckboxItem(id = Some(category.displayText.toLowerCase.replaceAll(" ", "-").replaceAll("[\\(\\)]","")), content = HtmlContent(s"<span class=\"govuk-!-font-size-16\">${category.displayText}</span>"), value = category.toString, checked = categoryFilters.contains(category)))
                    )
                )
            ),
            summary = Text("View API categories"),
            open = false
          )
        )
        <div class="govuk-body" style="font-size:16px; ">
            <strong id="categoryFilterCount">@{categoryFilters.size}</strong>  selected
        </div>
    </fieldset>

    <button id="filter-button" class="govuk-button" data-module="govuk-button" type="submit">Filter</button>

</form>

<script  @CSPNonce.attr src='@routes.Assets.versioned("javascripts/apiFilter.js")' type="text/javascript"></script>